// Generated by CoffeeScript 1.12.2
(function() {
  var decimalAdded, equation, i, input, inputVal, lastChar, onClick, operators, screen;

  screen = document.querySelector('.screen');

  onClick = document.querySelectorAll('#calculator span');

  decimalAdded = false;

  operators = ['+', '-', 'x', '/', '^'];

  input = '';

  inputVal = screen.innerHTML;

  equation = '';

  lastChar = '';

  document.addEventListener('keypress', function(event) {
    var keyCode, keyInput, keyVal, powFix;
    keyCode = event.keyCode || event.which;
    keyVal = String.fromCharCode(keyCode);
    keyInput = '';
    if ((keyVal >= 0) && (keyVal <= 9)) {
      input = keyVal;
      screen.innerHTML += input;
      return inputVal = screen.innerHTML;
    } else if (keyVal === '.') {
      if (decimalAdded !== true) {
        input = keyVal;
        screen.innerHTML += input;
        decimalAdded = true;
        return inputVal = screen.innerHTML;
      }
    } else if (keyVal === 'c') {
      return screen.innerHTML = '';
    } else if ((keyVal === '+') || (keyVal === '*') || (keyVal === '/') || (keyVal === '-')) {
      input = keyVal;
      screen.innerHTML += input;
      return inputVal = screen.innerHTML;
    } else if (keyVal === '^') {
      input = '^';
      screen.innerHTML += input;
      inputVal = screen.innerHTML;
      return powFix = true;
    } else if ((keyVal === '=') || (keyCode === 13)) {
      if (powFix !== false) {
        inputVal = inputVal.split('^').join('**');
        equation = eval(inputVal);
        return screen.innerHTML = equation;
      } else {
        equation = eval(inputVal);
        return screen.innerHTML = equation;
      }
    }
  });

  i = 0;

  while (i < onClick.length) {
    onClick[i].onclick = function(event) {
      var btnVal;
      btnVal = this.innerHTML;
      if (btnVal === 'C') {
        screen.innerHTML = '';
        decimalAdded = false;
      } else if (btnVal === '=') {
        inputVal = screen.innerHTML.replace(/x/g, '*').split('^').join('**');
        lastChar = inputVal[inputVal.length - 1];
        if ((operators.indexOf(lastChar) > -1) || (lastChar === '.')) {
          inputVal = inputVal.replace(/.$/, '');
        }
        if (inputVal !== '') {
          equation = eval(inputVal);
          screen.innerHTML = equation;
        }
        decimalAdded = false;
      } else if (operators.indexOf(btnVal) > -1) {
        inputVal = screen.innerHTML;
        lastChar = inputVal[inputVal.length - 1];
        if ((inputVal !== '') && (operators.indexOf(lastChar) === -1)) {
          screen.innerHTML += btnVal;
        } else if ((inputVal === '') && (btnVal === '-')) {
          screen.innerHTML += btnVal;
        }
        if ((operators.indexOf(lastChar) > -1) && (inputVal.length > 1)) {
          screen.innerHTML = inputVal.replace(/.$/, btnVal);
        }
        decimalAdded = false;
      } else if (btnVal === '.') {
        if (!decimalAdded) {
          screen.innerHTML += btnVal;
          decimalAdded = true;
        }
      } else {
        screen.innerHTML += btnVal;
        inputVal = screen.innerHTML;
      }
      return event.preventDefault();
    };
    i++;
  }

}).call(this);
